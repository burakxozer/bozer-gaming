<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Karambol Kriket</title>

<style>
:root{
  --bg:#0b1220;
  --panel:#111827;
  --line:#1f2937;
  --row1:#020617;
  --row2:#020a1f;
  --text:#e5e7eb;
  --accent:#22c55e;
}

*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,sans-serif}
body{margin:0;background:var(--bg);color:var(--text)}
.app{max-width:900px;margin:auto;padding:10px}

h1{text-align:center;margin:10px 0}

.card{
  background:var(--panel);
  border-radius:14px;
  padding:12px;
  margin-bottom:12px;
}

button{
  width:100%;
  padding:14px;
  font-size:18px;
  border:none;
  border-radius:12px;
  background:var(--accent);
  color:#000;
  margin-top:10px;
}

.btn-row{display:flex;gap:10px}
.btn-row button{flex:1}

input{
  width:100%;
  padding:14px;
  font-size:18px;
  border-radius:12px;
  border:none;
  margin-bottom:10px;
}

.board{display:grid;border-top:1px solid var(--line)}
.header,.row{display:grid}

.row:nth-child(even){background:var(--row1)}
.row:nth-child(odd){background:var(--row2)}

.cell{
  height:44px;
  display:flex;
  align-items:center;
  justify-content:center;
  border-left:1px solid var(--line);
  font-size:22px;
  user-select:none;
}
.cell:first-child{border-left:none}

.score{
  font-weight:700;
  background:rgba(0,0,0,.25);
}

.team-header{
  flex-direction:column;
  font-size:14px;
}
.team-header span{
  font-size:20px;
  font-weight:700;
}

.mark{
  width:26px;height:26px;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:50%;
}
.circle{border:2px solid var(--text)}

.controls{display:flex;gap:10px;margin-top:10px}
.controls button{background:#334155;color:#fff}

.winner-card{
  background:#16a34a;
  color:#000;
  text-align:center;
}
.winner-card h2{margin:10px 0}
.winner-card .cup{font-size:64px}
</style>
</head>

<body>
<div class="app">
<h1>KARAMBOL KRIKET</h1>

<!-- MODE -->
<div id="modeStep" class="card">
  <h3>Oyun Modu</h3>
  <div class="btn-row">
    <button onclick="setMode(1)">Best of 1</button>
    <button onclick="setMode(3)">Best of 3</button>
  </div>
</div>

<div id="step1" class="card" style="display:none">
  <h3>Takƒ±m Sayƒ±sƒ±</h3>
  <div class="btn-row">
    <button onclick="selectTeams(2)">2</button>
    <button onclick="selectTeams(3)">3</button>
    <button onclick="selectTeams(4)">4</button>
  </div>
</div>

<div id="step2" class="card" style="display:none">
  <h3>Takƒ±m ƒ∞simleri</h3>
  <div id="inputs"></div>
  <button onclick="startGame()">Ba≈üla</button>
</div>

<div id="game" class="card" style="display:none">
  <div id="board"></div>
  <div class="controls">
    <button onclick="undo()">Undo</button>
    <button onclick="resetBoard()">Reset</button>
  </div>
</div>

<div id="winner" class="card winner-card" style="display:none">
  <div class="cup">üèÜ</div>
  <h2 id="winnerName"></h2>
  <button onclick="location.reload()">Yeni Oyun</button>
</div>

</div>

<script>
const numbers=["20","19","18","17","16","15","14","13","12","D","T","B","H"];
const states=["","/","X","‚≠ï"];

let teamCount=0,teams=[],scores=[],history=[],points=[];
let bestOf=1;

const cap=s=>s.charAt(0).toUpperCase()+s.slice(1).toLowerCase();

function setMode(m){
  bestOf=m;
  modeStep.style.display="none";
  step1.style.display="block";
}

function selectTeams(n){
  teamCount=n;
  step1.style.display="none";
  step2.style.display="block";
  inputs.innerHTML="";
  for(let i=0;i<n;i++)
    inputs.innerHTML+=`<input placeholder="Takƒ±m ${i+1}">`;
}

function startGame(){
  teams=[...inputs.querySelectorAll("input")]
    .map(i=>cap(i.value||"Takƒ±m"));

  scores=Array.from({length:teamCount},()=>Array(numbers.length).fill(0));
  points=Array(teamCount).fill(0);

  step2.style.display="none";
  game.style.display="block";
  render();
}

function layout(){
  if(teamCount===2) return [1,1];
  if(teamCount===3) return [1,2];
  return [2,2];
}

function render(){
  board.innerHTML="";
  const [L,R]=layout();
  board.style.gridTemplateColumns=`repeat(${L},1fr) 52px repeat(${R},1fr)`;

  const header=document.createElement("div");
  header.className="header";
  header.style.gridTemplateColumns=board.style.gridTemplateColumns;

  teams.forEach((t,i)=>{
    const h=document.createElement("div");
    h.className="cell team-header";
    h.innerHTML=`${t}<span>${points[i]}</span>`;
    header.appendChild(h);
  });

  const mid=document.createElement("div");
  mid.className="cell score";
  header.insertBefore(mid,header.children[L]);
  board.appendChild(header);

  numbers.forEach((num,row)=>{
    const r=document.createElement("div");
    r.className="row";
    r.style.gridTemplateColumns=board.style.gridTemplateColumns;

    teams.forEach((_,t)=>{
      const c=document.createElement("div");
      c.className="cell";
      c.dataset.t=t;
      c.dataset.r=row;
      c.onclick=()=>toggle(c);
      updateCell(c);
      r.appendChild(c);
    });

    const s=document.createElement("div");
    s.className="cell score";
    s.textContent=num;
    r.insertBefore(s,r.children[L]);
    board.appendChild(r);
  });
}

function toggle(cell){
  history.push({...cell.dataset});
  scores[cell.dataset.t][cell.dataset.r]=(scores[cell.dataset.t][cell.dataset.r]+1)%4;
  updateCell(cell);
  checkWin();
}

function updateCell(cell){
  const v=scores[cell.dataset.t][cell.dataset.r];
  cell.innerHTML="";
  if(states[v]==="‚≠ï"){
    const m=document.createElement("div");
    m.className="mark circle";
    m.textContent="X";
    cell.appendChild(m);
  }else cell.textContent=states[v];
}

function checkWin(){
  scores.forEach((s,i)=>{
    if(s.every(v=>v===3)){
      points[i]++;
      resetBoard(true);

      if(bestOf===1 || points[i]===2){
        game.style.display="none";
        winner.style.display="block";
        winnerName.textContent=teams[i];
      }
    }
  });
}

function undo(){
  const h=history.pop();
  if(!h)return;
  scores[h.t][h.r]=(scores[h.t][h.r]+3)%4;
  render();
}

function resetBoard(keepPoints=false){
  scores=Array.from({length:teamCount},()=>Array(numbers.length).fill(0));
  history=[];
  if(!keepPoints) points.fill(0);
  render();
}
</script>
</body>
</html>
