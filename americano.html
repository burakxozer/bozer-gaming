<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AMERƒ∞CANO</title>

<style>
:root{
  --bg:#f4f6f8;
  --card:#ffffff;
  --line:#d6dae1;
  --blue:#2563eb;
  --red:#dc2626;
  --green:#16a34a;
  --ara:#fff1d6;
}

body{
  margin:0;
  font-family:Segoe UI,Arial,sans-serif;
  background:var(--bg);
}

h1{
  text-align:center;
  margin:18px 0 8px;
  letter-spacing:4px;
  font-weight:600;
}

.screen{
  max-width:1100px;
  margin:auto;
  padding:12px;
}

.card{
  background:var(--card);
  border-radius:14px;
  padding:16px;
  box-shadow:0 8px 22px rgba(0,0,0,.08);
}

.center{text-align:center}

button{
  padding:10px 18px;
  border:none;
  border-radius:10px;
  background:var(--blue);
  color:white;
  font-size:15px;
  margin:6px;
}

button.gray{background:#6b7280}
button.green{background:var(--green)}

input{
  width:100%;
  padding:10px;
  font-size:15px;
  border-radius:8px;
  border:1px solid var(--line);
}

.tableWrap{overflow-x:auto}

table{
  border-collapse:collapse;
  width:100%;
  min-width:600px;
  margin-top:10px;
  font-size:14px;
}

th,td{
  border:1px solid var(--line);
  padding:6px;
  text-align:center;
}

th.rule{
  text-align:left;
  padding-left:10px;
  white-space:nowrap;
}

.rule-black{color:#111}
.rule-blue{color:var(--blue);font-weight:600}
.rule-red{color:var(--red);font-weight:600}
.rule-green{color:var(--green);font-weight:600}

.arrow{color:var(--red);margin-right:6px}

.cell{
  width:100%;
  border:none;
  outline:none;
  background:none;
  text-align:center;
}

.ara{background:var(--ara);font-weight:600}

.popup{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:999;
}

.popupBox{
  background:white;
  padding:22px;
  border-radius:14px;
  width:90%;
  max-width:420px;
  text-align:left;
}

.hidden{display:none}
</style>
</head>

<body>
<h1>AMERƒ∞CANO</h1>
<div id="app"></div>

<script>
/* ==== DATA ==== */
const RULES=[
"K√úT","SERƒ∞","K√úT+ SERƒ∞","2x 3 K√úT","2x 3 SERƒ∞","4 K√úT","4 SERƒ∞",
"4 K√úT+ SERƒ∞","2 x 4 K√úT","2 x 4 SERƒ∞","5 SERƒ∞","√áƒ∞FT",
"JOKER","ARA TOPLAM","KONKEN","TOPLAM"
];

const JOKER_POOL=[
"K√úT","SERƒ∞","K√úT+ SERƒ∞","2x 3 K√úT","2x 3 SERƒ∞","4 K√úT","4 SERƒ∞",
"4 K√úT+ SERƒ∞","2 x 4 K√úT","2 x 4 SERƒ∞","5 SERƒ∞","√áƒ∞FT","KONKEN"
];

const CEZA={"/":25,"X":50,"X/":75,"XX":100,"XX/":125,"XXX":150,"XXX/":175,"XXXX":200};

let state={step:"count",count:0,players:[],active:0,joker:""};
const app=document.getElementById("app");
render();

/* ==== RENDER ==== */
function render(){
  app.innerHTML="";
  if(state.step==="count") countScreen();
  if(state.step==="names") nameScreen();
  if(state.step==="board") boardScreen();
}

/* ==== SCREENS ==== */
function countScreen(){
  app.innerHTML=`<div class="screen card center">
    <h2>Oyuncu Sayƒ±sƒ±</h2>
    ${[2,3,4,5].map(n=>`<button onclick="setCount(${n})">${n}</button>`).join("")}
  </div>`;
}

function setCount(n){
  state={step:"names",count:n,players:[],active:0,joker:""};
  render();
}

function nameScreen(){
  app.innerHTML=`<div class="screen card">
    <h2>Oyuncu ƒ∞simleri</h2>
    ${Array.from({length:state.count}).map((_,i)=>`
      <input id="p${i}" placeholder="Oyuncu ${i+1}"><br><br>`).join("")}
    <div class="center"><button onclick="start()">Ba≈üla</button></div>
  </div>`;
}

function formatName(n){
  return n.toLowerCase().split(" ").filter(Boolean)
    .map(w=>w[0].toUpperCase()+w.slice(1)).join(" ");
}

function start(){
  for(let i=0;i<state.count;i++){
    state.players.push(formatName(document.getElementById("p"+i).value));
  }
  state.step="board";
  render();
}

/* ==== BOARD ==== */
function boardScreen(){
  app.innerHTML=`<div class="screen card">
    <div id="jokerInfo" class="rule-green"></div>
    <div class="tableWrap"><table id="board"></table></div>
    <div class="center" id="chanceBtnWrap"></div>
  </div>

  <div id="jokerPopup" class="popup hidden">
    <div class="popupBox">
      <h2>üé≤ Joker Eli</h2>
      <button onclick="drawJoker()">Kura √áek</button>
      <h3 id="jokerAnim"></h3>
    </div>
  </div>

  <div id="chancePopup" class="popup hidden">
    <div class="popupBox">
      <h2>Kazanma ≈ûanslarƒ±</h2>
      <div id="chanceText"></div>
      <div class="center"><button class="gray" onclick="closeChance()">Geri</button></div>
    </div>
  </div>

  <div id="winnerPopup" class="popup hidden">
    <div class="popupBox">
      <h2>üèÜ Sonu√ß</h2>
      <pre id="winnerText"></pre>
      <div class="center">
        <button class="green" onclick="restart()">Tekrar Oyna</button>
        <button class="gray" onclick="render()">Yeni Oyun</button>
      </div>
    </div>
  </div>`;
  buildTable();
}

function buildTable(){
  const t=document.getElementById("board");
  t.innerHTML="";

  let tr=document.createElement("tr");
  let th=document.createElement("th");
  th.textContent="X";
  th.className="rule rule-red";
  tr.appendChild(th);

  state.players.forEach(()=>{
    let td=document.createElement("td");
    td.style.fontWeight="600";
    td.onclick=()=>cyclePenalty(td);
    tr.appendChild(td);
  });
  t.appendChild(tr);

  tr=document.createElement("tr");
  th=document.createElement("th");
  th.textContent="Oyuncu";
  tr.appendChild(th);
  state.players.forEach(p=>{
    let th2=document.createElement("th");
    th2.textContent=p;
    tr.appendChild(th2);
  });
  t.appendChild(tr);

  RULES.forEach(r=>{
    tr=document.createElement("tr");
    th=document.createElement("th");
    th.textContent=r;
    th.className="rule rule-black";
    tr.appendChild(th);
    state.players.forEach(()=>{
      let td=document.createElement("td");
      let i=document.createElement("input");
      i.className="cell";
      i.onblur=update;
      td.appendChild(i);
      tr.appendChild(td);
    });
    if(r==="ARA TOPLAM") tr.classList.add("ara");
    t.appendChild(tr);
  });
  update();
}

/* ==== LOGIC ==== */
function cyclePenalty(td){
  const seq=["","/","X","X/","XX","XX/","XXX","XXX/","XXXX"];
  let i=seq.indexOf(td.textContent);
  td.textContent=seq[(i+1)%seq.length];
}

function val(v){
  v=v.toUpperCase();
  if(v==="-"||v==="/")return -25;
  if(v==="X")return -50;
  if(v==="XX")return -100;
  return parseInt(v)||0;
}

function update(){
  const rows=document.getElementById("board").rows;

  for(let i=0;i<RULES.length;i++){
    const cell=rows[i+2].cells[0];
    cell.className="rule rule-black";
    cell.textContent=RULES[i];

    let filled=true;
    for(let c=1;c<rows[i+2].cells.length;c++){
      if(rows[i+2].cells[c].querySelector("input")?.value==="") filled=false;
    }

    if(i<state.active){
      cell.className="rule rule-red";
    }else if(i===state.active){
      cell.className=RULES[i]==="JOKER"?"rule rule-green":"rule rule-blue";
      cell.innerHTML="‚û§ "+RULES[i];
      if(filled){
        state.active++;
        calcAra();
        if(RULES[i]==="√áƒ∞FT"){
          setTimeout(()=>document.getElementById("jokerPopup").classList.remove("hidden"),800);
        }
        if(RULES[i]==="JOKER"){
          document.getElementById("chanceBtnWrap").innerHTML=
            `<button onclick="showChances()">Kazanma ≈ûanslarƒ±</button>`;
        }
        update();
        return;
      }
    }
  }

  if(RULES[state.active-1]==="KONKEN"){
    setTimeout(showWinner,3000);
  }
}

function calcAra(){
  const rows=document.getElementById("board").rows;
  const araRow=RULES.indexOf("ARA TOPLAM")+2;

  for(let c=1;c<=state.players.length;c++){
    let sum=CEZA[rows[0].cells[c].textContent]||0;
    for(let r=2;r<araRow;r++){
      sum+=val(rows[r].cells[c].querySelector("input").value);
    }
    rows[araRow].cells[c].textContent=sum;
  }
}

/* ==== JOKER ==== */
function drawJoker(){
  let a=document.getElementById("jokerAnim");
  let i=0;
  let int=setInterval(()=>{
    a.textContent=JOKER_POOL[Math.floor(Math.random()*JOKER_POOL.length)];
    if(++i>18){
      clearInterval(int);
      state.joker=a.textContent;
      document.getElementById("jokerInfo").textContent="Joker Eli: "+state.joker;
      setTimeout(()=>document.getElementById("jokerPopup").classList.add("hidden"),2000);
    }
  },100);
}

/* ==== KAZANMA ≈ûANSLARI ==== */
function showChances(){
  const rows=document.getElementById("board").rows;
  const araRow=RULES.indexOf("ARA TOPLAM")+2;

  let arr=[];
  for(let c=1;c<=state.players.length;c++){
    arr.push({
      name:state.players[c-1],
      score:parseInt(rows[araRow].cells[c].textContent)||0
    });
  }

  arr.sort((a,b)=>a.score-b.score);
  let first=arr[0].score;
  let html="";

  arr.forEach((p,i)=>{
    let diff=p.score-first;
    let text="";

    if(i===0 || diff<=90) text="Biterse kazanƒ±r";
    else if(diff<=125) text="Biterse kazanamayabilir, Job denenebilir";
    else if(diff<=200) text="Job'la kazanƒ±r";
    else if(diff<=350) text="Job yetmeyebilir";
    else text="Bo≈üver kanka sen";

    html+=`<p><b>${p.name}</b>: ${text}</p>`;
  });

  document.getElementById("chanceText").innerHTML=html;
  document.getElementById("chancePopup").classList.remove("hidden");
}

function closeChance(){
  document.getElementById("chancePopup").classList.add("hidden");
}

/* ==== WINNER ==== */
function showWinner(){
  const rows=document.getElementById("board").rows;
  let res=[];
  for(let c=1;c<=state.players.length;c++){
    let total=parseInt(rows[RULES.indexOf("ARA TOPLAM")+2].cells[c].textContent)||0;
    total+=val(rows[RULES.indexOf("KONKEN")+2].cells[c].querySelector("input").value);
    res.push({name:state.players[c-1],score:total});
  }
  res.sort((a,b)=>a.score-b.score);
  document.getElementById("winnerText").textContent=
    res.map((p,i)=>`${i===0?"üèÜ":i+1+"."} ${p.name} ‚Äì ${p.score}`).join("\n");
  document.getElementById("winnerPopup").classList.remove("hidden");
}

function restart(){
  state.active=0;
  state.joker="";
  render();
}
</script>
</body>
</html>
